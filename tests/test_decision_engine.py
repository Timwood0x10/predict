#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å†³ç­–å¼•æ“æµ‹è¯•è„šæœ¬
æµ‹è¯•å„ç§å¸‚åœºåœºæ™¯ä¸‹çš„å†³ç­–é€»è¾‘
"""

import sys
import logging
from utils.decision_engine import DecisionEngine

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

def test_scenario(name: str, features: list, news_data: list = None):
    """æµ‹è¯•å•ä¸ªåœºæ™¯"""
    print("\n" + "="*70)
    print(f"ğŸ§ª æµ‹è¯•åœºæ™¯: {name}")
    print("="*70)
    
    engine = DecisionEngine(account_balance=10000, risk_percent=0.015)
    result = engine.analyze(features, news_data)
    
    print(engine.format_decision_report(result))
    return result


def main():
    """è¿è¡Œæ‰€æœ‰æµ‹è¯•åœºæ™¯"""
    
    print("ğŸš€ å¼€å§‹æµ‹è¯•å†³ç­–å¼•æ“")
    print("="*70)
    
    # ==================== åœºæ™¯1: å¼ºçƒˆçœ‹æ¶¨ä¿¡å· ====================
    features_bullish = [
        12.0,   # [0] ETH Gas - ä½
        6.0,    # [1] BTC Fee - ä½
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        2.0,    # [5] 24hæ¶¨è·Œ +2% (æ¸©å’Œä¸Šæ¶¨)
        1500000,# [6] æˆäº¤é‡
        0.018,  # [7] æ³¢åŠ¨ç‡ 1.8% (ä½)
        1,      # [8] è¶‹åŠ¿ ä¸Šæ¶¨
        50800,  # [9] æœ€é«˜
        49200,  # [10] æœ€ä½
        49500,  # [11] å¼€ç›˜
        0.68,   # [12] RSI
        0.40,   # [13] æ–°é—»æ­£é¢ 40%
        0.08,   # [14] æ–°é—»è´Ÿé¢ 8%
        18,     # [15] æ–°é—»æ•°é‡
        1,      # [16] æ–°é—»çœ‹æ¶¨
        0.82,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.78,   # [18] å¸‚åœºç½®ä¿¡åº¦
        60,     # [19] ææƒ§è´ªå©ªæŒ‡æ•° (æ¸©å’Œä¹è§‚)
        1,      # [20] å¸‚åœºçœ‹æ¶¨
        0.80,   # [21] AIç½®ä¿¡åº¦
        3,      # [22] AIçœ‹æ¶¨æ•°
        0,      # [23] AIçœ‹è·Œæ•°
        1.0,    # [24] AIä¸€è‡´æ€§ 100%
        1       # [25] AIå…±è¯† çœ‹æ¶¨
    ]
    
    result1 = test_scenario("å¼ºçƒˆçœ‹æ¶¨ä¿¡å· (ç†æƒ³ä¹°å…¥)", features_bullish)
    
    # ==================== åœºæ™¯2: å¼ºçƒˆçœ‹è·Œä¿¡å· ====================
    features_bearish = [
        15.0,   # [0] ETH Gas
        8.0,    # [1] BTC Fee
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        -2.2,   # [5] 24hæ¶¨è·Œ -2.2% (æ¸©å’Œä¸‹è·Œ)
        1200000,# [6] æˆäº¤é‡
        0.022,  # [7] æ³¢åŠ¨ç‡ 2.2%
        -1,     # [8] è¶‹åŠ¿ ä¸‹è·Œ
        50500,  # [9] æœ€é«˜
        48800,  # [10] æœ€ä½
        50300,  # [11] å¼€ç›˜
        0.35,   # [12] RSI
        0.12,   # [13] æ–°é—»æ­£é¢ 12%
        0.38,   # [14] æ–°é—»è´Ÿé¢ 38%
        15,     # [15] æ–°é—»æ•°é‡
        -1,     # [16] æ–°é—»çœ‹è·Œ
        0.75,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.72,   # [18] å¸‚åœºç½®ä¿¡åº¦
        35,     # [19] ææƒ§è´ªå©ªæŒ‡æ•° (ææƒ§)
        -1,     # [20] å¸‚åœºçœ‹è·Œ
        0.78,   # [21] AIç½®ä¿¡åº¦
        0,      # [22] AIçœ‹æ¶¨æ•°
        3,      # [23] AIçœ‹è·Œæ•°
        1.0,    # [24] AIä¸€è‡´æ€§ 100%
        -1      # [25] AIå…±è¯† çœ‹è·Œ
    ]
    
    result2 = test_scenario("å¼ºçƒˆçœ‹è·Œä¿¡å· (ç†æƒ³å–å‡º)", features_bearish)
    
    # ==================== åœºæ™¯3: ä¿¡å·ä¸æ˜ç¡® - HOLD ====================
    features_neutral = [
        20.0,   # [0] ETH Gas
        10.0,   # [1] BTC Fee
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        0.3,    # [5] 24hæ¶¨è·Œ +0.3% (å‡ ä¹ä¸å˜)
        1000000,# [6] æˆäº¤é‡
        0.025,  # [7] æ³¢åŠ¨ç‡ 2.5%
        0,      # [8] è¶‹åŠ¿ å¹³ç¨³
        50200,  # [9] æœ€é«˜
        49800,  # [10] æœ€ä½
        50000,  # [11] å¼€ç›˜
        0.50,   # [12] RSI
        0.25,   # [13] æ–°é—»æ­£é¢ 25%
        0.20,   # [14] æ–°é—»è´Ÿé¢ 20%
        10,     # [15] æ–°é—»æ•°é‡
        0,      # [16] æ–°é—»ä¸­æ€§
        0.60,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.55,   # [18] å¸‚åœºç½®ä¿¡åº¦
        50,     # [19] ææƒ§è´ªå©ªæŒ‡æ•° (ä¸­æ€§)
        0,      # [20] å¸‚åœºä¸­æ€§
        0.62,   # [21] AIç½®ä¿¡åº¦
        1,      # [22] AIçœ‹æ¶¨æ•°
        1,      # [23] AIçœ‹è·Œæ•°
        0.50,   # [24] AIä¸€è‡´æ€§ 50%
        0       # [25] AIå…±è¯† ä¸æ˜ç¡®
    ]
    
    result3 = test_scenario("ä¿¡å·ä¸æ˜ç¡® (è§‚æœ›)", features_neutral)
    
    # ==================== åœºæ™¯4: Gasè´¹ç”¨è¿‡é«˜ - HOLD ====================
    features_high_gas = [
        55.0,   # [0] ETH Gas - éå¸¸é«˜ï¼
        25.0,   # [1] BTC Fee - éå¸¸é«˜ï¼
        0,      # [2] ETHä¸é€‚åˆ
        0,      # [3] BTCä¸é€‚åˆ
        50000,  # [4] ä»·æ ¼
        2.5,    # [5] 24hæ¶¨è·Œ
        1500000,# [6] æˆäº¤é‡
        0.018,  # [7] æ³¢åŠ¨ç‡
        1,      # [8] è¶‹åŠ¿ ä¸Šæ¶¨
        50800,  # [9] æœ€é«˜
        49200,  # [10] æœ€ä½
        49500,  # [11] å¼€ç›˜
        0.68,   # [12] RSI
        0.40,   # [13] æ–°é—»æ­£é¢
        0.08,   # [14] æ–°é—»è´Ÿé¢
        18,     # [15] æ–°é—»æ•°é‡
        1,      # [16] æ–°é—»çœ‹æ¶¨
        0.82,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.78,   # [18] å¸‚åœºç½®ä¿¡åº¦
        60,     # [19] ææƒ§è´ªå©ª
        1,      # [20] å¸‚åœºçœ‹æ¶¨
        0.80,   # [21] AIç½®ä¿¡åº¦
        3,      # [22] AIçœ‹æ¶¨æ•°
        0,      # [23] AIçœ‹è·Œæ•°
        1.0,    # [24] AIä¸€è‡´æ€§
        1       # [25] AIå…±è¯† çœ‹æ¶¨
    ]
    
    result4 = test_scenario("Gasè´¹ç”¨è¿‡é«˜ (å®‰å…¨æ£€æŸ¥å¤±è´¥)", features_high_gas)
    
    # ==================== åœºæ™¯5: æ³¢åŠ¨ç‡è¿‡é«˜ - HOLD ====================
    features_high_volatility = [
        12.0,   # [0] ETH Gas - æ­£å¸¸
        6.0,    # [1] BTC Fee - æ­£å¸¸
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        5.5,    # [5] 24hæ¶¨è·Œ +5.5% (æ³¢åŠ¨å¤§)
        2000000,# [6] æˆäº¤é‡
        0.055,  # [7] æ³¢åŠ¨ç‡ 5.5% (è¿‡é«˜ï¼)
        1,      # [8] è¶‹åŠ¿ ä¸Šæ¶¨
        52500,  # [9] æœ€é«˜
        48000,  # [10] æœ€ä½
        49000,  # [11] å¼€ç›˜
        0.75,   # [12] RSI
        0.40,   # [13] æ–°é—»æ­£é¢
        0.08,   # [14] æ–°é—»è´Ÿé¢
        18,     # [15] æ–°é—»æ•°é‡
        1,      # [16] æ–°é—»çœ‹æ¶¨
        0.82,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.78,   # [18] å¸‚åœºç½®ä¿¡åº¦
        60,     # [19] ææƒ§è´ªå©ª
        1,      # [20] å¸‚åœºçœ‹æ¶¨
        0.80,   # [21] AIç½®ä¿¡åº¦
        3,      # [22] AIçœ‹æ¶¨æ•°
        0,      # [23] AIçœ‹è·Œæ•°
        1.0,    # [24] AIä¸€è‡´æ€§
        1       # [25] AIå…±è¯† çœ‹æ¶¨
    ]
    
    result5 = test_scenario("æ³¢åŠ¨ç‡è¿‡é«˜ (å®‰å…¨æ£€æŸ¥å¤±è´¥)", features_high_volatility)
    
    # ==================== åœºæ™¯6: å¸‚åœºæç«¯è´ªå©ª - HOLD ====================
    features_extreme_greed = [
        12.0,   # [0] ETH Gas
        6.0,    # [1] BTC Fee
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        3.0,    # [5] 24hæ¶¨è·Œ
        1500000,# [6] æˆäº¤é‡
        0.018,  # [7] æ³¢åŠ¨ç‡
        1,      # [8] è¶‹åŠ¿ ä¸Šæ¶¨
        50800,  # [9] æœ€é«˜
        49200,  # [10] æœ€ä½
        49500,  # [11] å¼€ç›˜
        0.68,   # [12] RSI
        0.40,   # [13] æ–°é—»æ­£é¢
        0.08,   # [14] æ–°é—»è´Ÿé¢
        18,     # [15] æ–°é—»æ•°é‡
        1,      # [16] æ–°é—»çœ‹æ¶¨
        0.82,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.78,   # [18] å¸‚åœºç½®ä¿¡åº¦
        85,     # [19] ææƒ§è´ªå©ª (æç«¯è´ªå©ªï¼)
        1,      # [20] å¸‚åœºçœ‹æ¶¨
        0.80,   # [21] AIç½®ä¿¡åº¦
        3,      # [22] AIçœ‹æ¶¨æ•°
        0,      # [23] AIçœ‹è·Œæ•°
        1.0,    # [24] AIä¸€è‡´æ€§
        1       # [25] AIå…±è¯† çœ‹æ¶¨
    ]
    
    result6 = test_scenario("å¸‚åœºæç«¯è´ªå©ª (å®‰å…¨æ£€æŸ¥å¤±è´¥)", features_extreme_greed)
    
    # ==================== åœºæ™¯7: æ•°æ®ä¸è¶³ - HOLD ====================
    features_insufficient_data = [
        12.0,   # [0] ETH Gas
        6.0,    # [1] BTC Fee
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        2.0,    # [5] 24hæ¶¨è·Œ
        1500000,# [6] æˆäº¤é‡
        0.018,  # [7] æ³¢åŠ¨ç‡
        1,      # [8] è¶‹åŠ¿ ä¸Šæ¶¨
        50800,  # [9] æœ€é«˜
        49200,  # [10] æœ€ä½
        49500,  # [11] å¼€ç›˜
        0.68,   # [12] RSI
        0.40,   # [13] æ–°é—»æ­£é¢
        0.08,   # [14] æ–°é—»è´Ÿé¢
        3,      # [15] æ–°é—»æ•°é‡ (åªæœ‰3æ¡ï¼Œä¸è¶³ï¼)
        1,      # [16] æ–°é—»çœ‹æ¶¨
        0.82,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.78,   # [18] å¸‚åœºç½®ä¿¡åº¦
        60,     # [19] ææƒ§è´ªå©ª
        1,      # [20] å¸‚åœºçœ‹æ¶¨
        0.80,   # [21] AIç½®ä¿¡åº¦
        0,      # [22] AIçœ‹æ¶¨æ•° (æ²¡æœ‰AIé¢„æµ‹ï¼)
        0,      # [23] AIçœ‹è·Œæ•°
        0.0,    # [24] AIä¸€è‡´æ€§
        0       # [25] AIå…±è¯† ä¸æ˜ç¡®
    ]
    
    result7 = test_scenario("æ•°æ®ä¸è¶³ (å®‰å…¨æ£€æŸ¥å¤±è´¥)", features_insufficient_data)
    
    # ==================== åœºæ™¯8: ä¸€è‡´æ€§ä¸è¶³ - HOLD ====================
    features_low_consistency = [
        12.0,   # [0] ETH Gas
        6.0,    # [1] BTC Fee
        1,      # [2] ETHé€‚åˆ
        1,      # [3] BTCé€‚åˆ
        50000,  # [4] ä»·æ ¼
        1.5,    # [5] 24hæ¶¨è·Œ
        1500000,# [6] æˆäº¤é‡
        0.018,  # [7] æ³¢åŠ¨ç‡
        1,      # [8] è¶‹åŠ¿ ä¸Šæ¶¨ âœ“
        50800,  # [9] æœ€é«˜
        49200,  # [10] æœ€ä½
        49500,  # [11] å¼€ç›˜
        0.68,   # [12] RSI
        0.30,   # [13] æ–°é—»æ­£é¢
        0.15,   # [14] æ–°é—»è´Ÿé¢
        12,     # [15] æ–°é—»æ•°é‡
        -1,     # [16] æ–°é—»çœ‹è·Œ âœ— (çŸ›ç›¾ï¼)
        0.70,   # [17] æ–°é—»ç½®ä¿¡åº¦
        0.65,   # [18] å¸‚åœºç½®ä¿¡åº¦
        58,     # [19] ææƒ§è´ªå©ª
        1,      # [20] å¸‚åœºçœ‹æ¶¨ âœ“
        0.65,   # [21] AIç½®ä¿¡åº¦
        1,      # [22] AIçœ‹æ¶¨æ•°
        1,      # [23] AIçœ‹è·Œæ•° (çŸ›ç›¾ï¼)
        0.50,   # [24] AIä¸€è‡´æ€§ 50%
        0       # [25] AIå…±è¯† ä¸æ˜ç¡®
    ]
    
    result8 = test_scenario("ä¸€è‡´æ€§ä¸è¶³ (ä¿¡å·çŸ›ç›¾)", features_low_consistency)
    
    # ==================== æµ‹è¯•æ€»ç»“ ====================
    print("\n" + "="*70)
    print("ğŸ“Š æµ‹è¯•æ€»ç»“")
    print("="*70)
    
    scenarios = [
        ("åœºæ™¯1: å¼ºçƒˆçœ‹æ¶¨", result1),
        ("åœºæ™¯2: å¼ºçƒˆçœ‹è·Œ", result2),
        ("åœºæ™¯3: ä¿¡å·ä¸æ˜ç¡®", result3),
        ("åœºæ™¯4: Gasè¿‡é«˜", result4),
        ("åœºæ™¯5: æ³¢åŠ¨ç‡è¿‡é«˜", result5),
        ("åœºæ™¯6: å¸‚åœºæç«¯è´ªå©ª", result6),
        ("åœºæ™¯7: æ•°æ®ä¸è¶³", result7),
        ("åœºæ™¯8: ä¸€è‡´æ€§ä¸è¶³", result8),
    ]
    
    print("\nå†³ç­–ç»Ÿè®¡:")
    buy_count = sum(1 for _, r in scenarios if r['decision']['action'] == 'BUY')
    sell_count = sum(1 for _, r in scenarios if r['decision']['action'] == 'SELL')
    hold_count = sum(1 for _, r in scenarios if r['decision']['action'] == 'HOLD')
    
    print(f"  ğŸŸ¢ BUY:  {buy_count} æ¬¡")
    print(f"  ğŸ”´ SELL: {sell_count} æ¬¡")
    print(f"  âšª HOLD: {hold_count} æ¬¡")
    
    print("\nå„åœºæ™¯ç»“æœ:")
    for name, result in scenarios:
        action = result['decision']['action']
        confidence = result['decision']['confidence']
        emoji = "ğŸŸ¢" if action == "BUY" else ("ğŸ”´" if action == "SELL" else "âšª")
        print(f"  {emoji} {name}: {action} (ç½®ä¿¡åº¦: {confidence:.0f}%)")
    
    print("\n" + "="*70)
    print("âœ… æµ‹è¯•å®Œæˆï¼å†³ç­–å¼•æ“è¿è¡Œæ­£å¸¸ã€‚")
    print("="*70)


if __name__ == "__main__":
    main()
