# 🤖 AI数据整合与决策指南

## 🎯 核心思路

将Gas、新闻、K线、情绪等多维数据整合为**AI可理解的决策信号**，通过**分层评估**让AI做出准确的交易决策。

---

## 📊 三层决策架构

```
┌─────────────────────────────────────────┐
│ Layer 1: 前提条件 (必须满足)            │
│   Gas费用 + 数据质量 + 市场状态         │
│   ↓ 通过/不通过                         │
├─────────────────────────────────────────┤
│ Layer 2: 信号评分 (0-100分)             │
│   - 新闻信号 (30%) ⭐ 重点              │
│   - 价格信号 (25%)                      │
│   - 情绪信号 (25%)                      │
│   - AI信号 (20%)                        │
│   ↓ 加权总分                            │
├─────────────────────────────────────────┤
│ Layer 3: 风险评估                       │
│   波动率 + 仓位建议                     │
│   ↓ BUY/SELL/HOLD + 置信度             │
└─────────────────────────────────────────┘
```

---

## 💡 核心逻辑：新闻驱动 + 多维验证

### 为什么新闻权重最高（30%）？

**美联储、中美关系、关税是市场最大的影响因素！**

1. **美联储加息** → 流动性收紧 → 加密货币下跌
2. **中美关税** → 避险情绪 → 资金流向
3. **政策利好** → 市场信心 → 价格上涨

所以新闻信号是**最重要的前瞻性指标**！

---

## 🔍 详细实现

### Layer 1: 前提条件（Gate Keeper）

```python
# 26维特征向量
features = integrated['features']

# 必须同时满足：
conditions = {
    "gas_ok": features[0] < 50 or features[1] < 20,  # Gas合理
    "data_ok": features[15] >= 5,                     # 至少5条新闻
    "market_ok": 20 < features[19] < 80,             # 市场不极端
    "volatility_ok": features[7] < 0.05              # 波动可控
}

if not all(conditions.values()):
    return "HOLD"  # 不满足条件，观望
```

### Layer 2: 新闻信号（30%权重）⭐

```python
def news_signal(features):
    """
    新闻信号 0-100分
    
    重点关注:
    - 美联储政策（加息/降息）
    - 中美关系（关税/贸易战）
    - 监管政策（ETF批准/禁令）
    """
    score = 50  # 基础分
    
    # 新闻情绪
    if features[16] == 1:      # 看涨
        score += 20
    elif features[16] == -1:   # 看跌
        score -= 20
    
    # 正负面比例
    if features[13] > 0.3:     # 30%正面新闻
        score += 15
    elif features[14] > 0.3:   # 30%负面新闻
        score -= 15
    
    # 关注度
    if features[15] > 15:      # 高关注度
        score += 10
    
    return max(0, min(100, score))
```

**关键点**: 
- 如果新闻提到"美联储加息" → 看跌信号
- 如果新闻提到"ETF批准" → 看涨信号
- 如果新闻提到"中美缓和" → 看涨信号

### Layer 2: 其他信号

**价格信号（25%）**:
- 趋势方向
- 24h涨跌幅
- 波动率

**情绪信号（25%）**:
- 恐惧贪婪指数（最重要）
- 市场情绪标签

**AI信号（20%）**:
- AI预测共识
- 预测一致性

### Layer 3: 最终决策

```python
# 计算加权总分
total_score = (
    news_signal * 0.30 +      # 新闻 30%
    price_signal * 0.25 +     # 价格 25%
    sentiment_signal * 0.25 + # 情绪 25%
    ai_signal * 0.20          # AI 20%
)

# 决策
if total_score > 70:
    action = "BUY"
elif total_score < 30:
    action = "SELL"
else:
    action = "HOLD"
```

---

## 📝 AI Prompt设计

### 方案A: 结构化Prompt（推荐）

```
请基于以下市场数据做出BTC交易决策:

【前提条件】✅
Gas费用: ETH 0.10 Gwei, BTC 1 sat/vB (都适合交易)

【新闻信号】⭐ 最重要
总计: 17条新闻
情绪: 正面18% / 负面6%
热点: fed(2次), china(1次), tariff(1次), btc(5次)
最新标题:
1. 特朗普矛头再指鲍威尔要求美联储降息
2. 中国扩大贸易协定覆盖范围
3. BTC巨鲸从Kraken提取894枚

【价格信号】
当前: $113,134, 24h +0.35%, 趋势平稳

【市场情绪】
恐惧贪婪指数: 51/100 (中性)

【AI预测】
暂无数据

请回答: BUY/SELL/HOLD?
理由: (简短说明)
置信度: 0-100
```

### 方案B: 超精简Prompt（省Token）

```
BTC决策请求:

条件✅: Gas低, 新闻17条
新闻⭐: 正18%/负6%, 关键词[fed,china,tariff,btc]
价格: $113k, +0.35%, 平稳
情绪: 恐惧贪婪51/100

决策?
```

---

## 🎯 实战案例

### 案例1: 美联储加息预期

**输入数据**:
- 新闻: "美联储暗示下月加息50基点"
- 关键词: [fed, rate hike, inflation]
- 新闻情绪: 负面
- 价格: 上涨2%
- 恐惧贪婪: 65

**分析**:
- 新闻信号: 30分（负面）
- 价格信号: 60分（上涨）
- 情绪信号: 60分（温和贪婪）
- **总分**: 45分

**决策**: HOLD 或 轻仓SELL
**理由**: 加息预期是重大利空，虽然价格上涨但不可持续

### 案例2: ETF批准利好

**输入数据**:
- 新闻: "SEC批准比特币现货ETF"
- 关键词: [btc, etf, sec, approval]
- 新闻情绪: 正面
- 价格: 上涨5%
- 恐惧贪婪: 72

**分析**:
- 新闻信号: 85分（强烈正面）
- 价格信号: 70分（上涨但不过热）
- 情绪信号: 65分（贪婪但未极端）
- **总分**: 75分

**决策**: BUY
**理由**: 重大利好，市场确认

---

## 💡 关键决策规则

### 新闻优先原则

1. **美联储政策 > 一切**
   - 加息预期 → 谨慎/卖出
   - 降息预期 → 积极/买入

2. **中美关系次之**
   - 关税增加 → 风险上升
   - 关系缓和 → 风险下降

3. **监管政策很重要**
   - ETF批准 → 利好
   - 禁令/打压 → 利空

4. **价格是确认信号**
   - 利好+上涨 → 确认买入
   - 利空+下跌 → 确认卖出
   - 利好+下跌 → 警惕
   - 利空+上涨 → 反弹后卖出

---

## 🎨 实现方式

### 选项1: 纯规则引擎
- 完全基于规则
- 确定性输出
- 无需LLM

### 选项2: 规则+LLM验证（推荐）⭐
- 规则快速评分
- LLM提供第二意见
- 降低误判

### 选项3: 纯LLM决策
- 最灵活
- 依赖LLM质量
- 成本较高

---

## ✅ 总结

**核心逻辑**:
1. 新闻是最重要的前瞻性指标（30%）
2. 美联储、中美、关税是关键
3. 价格和情绪是确认信号
4. 三层验证确保安全

**下一步**: 立即实现决策引擎！
